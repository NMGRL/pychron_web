{% extends "base.html" %}
{% load leaflet_tags %}
{% load static %}
{% load django_tables2 %}
{% load bootstrap3 %}

{% block head %}
    {% leaflet_js %}
    {% leaflet_css %}

{#    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">#}
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
{#    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>#}

{% endblock %}

{% block content %}
    <div class="container pychron-main-container">
        <div class="row">
            <div class="col-md-5">
                <div class="pychron-inner-container">
                    <table class="table">
                        <thead><tr><th>Attribute</th><th>Current Value</th></tr></thead>
                        <tr><td>Sample</td> <td>{{ object.name }}</td></tr>
                        <tr><td>Material</td> <td><a href="/materials/{{ object.materialid.id }}">
                            {{ object.materialid.full_name }}</a></td></tr>
                        <tr><td>Project</td> <td><a href="/projects/{{ object.projectid.id }}">
                            {{ object.projectid.name }}</a></td></tr>
                        <tr><td>Principal Investigator</td> <td><a href="/principal_investigators/{{ object.projectid.principal_investigatorid.id }}">
                            {{ object.projectid.principal_investigatorid.full_name }}</a></td></tr>
                        <tr><td>Unit</td> <td>{{ object.unit }}</td></tr>
                        <tr><td>Latitude</td> <td>{{ object.lat }}</td></tr>
                        <tr><td>Longitude</td> <td>{{ object.lon }}</td></tr>
                        <tr><td>N. Analyses</td> <td>{{ nanalyses }}</td></tr>
                        <tr><td>Analyses Start</td> <td>{{ analyses_start }}</td></tr>
                        <tr><td>Analyses End</td> <td>{{ analyses_end }}</td></tr>
                    </table>
                </div>
            </div>
            <div class="col-md-7">
                <div class="pychron-inner-container">
                {% leaflet_map "map" callback='map_init' %}
                </div>
            </div>
        </div>
        <div class="row">
            {% if events %}
                <div class="col-md-12">
                    <div class="pychron-inner-container">
                        {% render_table events %}
                    </div>
                </div>
            {%  endif %}
        </div>
        <div class="row">
            <div class="col-md-5">
                <div class="pychron-inner-container">
                {% if form  %}
                    <form action="/samples/edit_sample/{{ object.id }}/" method="post">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <input type="submit" value="Save"/>
                    </form>
                {% else %}
                    <h2>You do not have permissions to edit this sample</h2>
                {% endif %}
                </div>
            </div>
            <div class="col-md-5">
                <div class="pychron-inner-container">
                {% if event_form  %}

                    <form action="/samples/edit_sample/{{ object.id }}/" method="post">
                        {% csrf_token %}
                        {{ event_form.as_p }}
{#                        <table style="display: none">{{ view.formset.empty_form }}</table>#}
{#                        <table>{{ view.formset }}</table>#}
                        <input type="submit" value="Save"/>
                    </form>
{#                    <script>#}
{#                        $(document).ready(function() {#}
{#                            $('.datepicker').datepicker();#}
{#                        });#}
{#                    </script>#}
                {% else %}
                    <h2>You do not have permissions to edit this sample</h2>
                {% endif %}
            </div>
            </div>
        </div>
        <div class="row">
            {% if analyses %}
                <div class="col-md-12">
                    <div class="pychron-inner-container">
                        {% render_table analyses %}
                    </div>
                </div>
            {%  endif %}
        </div>
    </div>




<script type="text/javascript">
                        function map_init(map, options) {

                            // get point lat and lon
                            var lon = "{{ object.lon }}";
                            var lat = "{{ object.lat }}";
                            // zoom to point & add it to map
                            map.setView([lat, lon]);
                            L.marker([lat, lon]).bindPopup(
                                '<table class="table"> \
                        <tr><td>Sample</td><td>{{ object.name }}</td></tr> \
                    <tr><td>Material</td><td>{{ object.materialid.full_name }}</td></tr> \
                </table>'
                            ).addTo(map);

                            {% for s in nearby_samples %}
                                L.circleMarker([{{ s.lat }}, {{ s.lon }}],
                                    {radius: 3}
                                    ).bindPopup(
                                        '<table class="table"> \
    <tr><td>Sample</td><td><a href="/samples/{{ s.id }}">{{ s.name }}</a></td></tr> \
    <tr><td>Material</td><td><a href="/materials/{{ s.materialid.id }}">{{ s.materialid.full_name }}</a></td></tr> \
    <tr><td>Project</td><td><a href="/projects/{{ s.projectid.id }}">{{ s.projectid.piname }}</a></td></tr> \
    <tr><td>Unit</td><td>{{ s.unit }}</td></tr> \
    </table>'
                                ).addTo(map);
                            {% endfor %}
                        }
                    </script>
{% endblock %}
